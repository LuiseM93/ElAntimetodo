---
layout: default
title: Comunidad Antimétodo
permalink: /comunidad/
---

<style>
  body {
    background: linear-gradient(rgba(74, 20, 140, 0.8), rgba(74, 20, 140, 0.8)), 
                url('/ElAntimetodo/assets/background-counter.jpg');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    min-height: 100vh;
    margin: 0;
    padding: 0;
    color: white;
    font-family: 'Arial', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  .community-box {
    background: rgba(255, 255, 255, 0.9);
    width: 90%;
    max-width: 450px;
    padding: 2.5rem;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    text-align: center;
    border: 1px solid #d1c4e9;
  }
  
  h1 {
    color: #4a148c;
    margin-bottom: 1.5rem;
  }
  
  .counter {
    font-size: 3.5rem;
    font-weight: bold;
    color: #7b1fa2;
    margin: 1rem 0;
  }
  
  .btn-join {
    background: #7b1fa2;
    color: white;
    border: none;
    padding: 0.8rem 2rem;
    border-radius: 50px;
    font-size: 1rem;
    cursor: pointer;
    margin-top: 1.5rem;
    transition: all 0.3s;
  }
  
  .btn-join:hover {
    background: #4a148c;
    transform: translateY(-3px);
  }
  
  #message {
    margin-top: 1rem;
    min-height: 1.5rem;
    color: #7b1fa2;
  }
</style>

<div class="community-box">
  <h1>Comunidad Antimétodo</h1>
  <p>Únete a miles aprendiendo idiomas naturalmente</p>
  
  <div class="counter" id="counter">0</div>
  <p>Seguidores del método</p>
  
  <button class="btn-join" id="joinBtn">¡Quiero unirme!</button>
  <p id="message"></p>
</div>

<script>
// Solución definitiva para el contador
async function updateCounter() {
  try {
    // 1. Obtener contador actual
    const response = await fetch('https://luisem93.github.io/ElAntimetodo/data/followers.json?t=' + Date.now());
    const data = await response.json();
    document.getElementById('counter').textContent = data.count;
    
    // 2. Manejar el botón
    document.getElementById('joinBtn').addEventListener('click', async () => {
      if (localStorage.getItem('hasJoined')) {
        document.getElementById('message').textContent = '¡Ya eres parte de la comunidad!';
        return;
      }
      
      try {
        const response = await fetch('https://api.github.com/repos/LuiseM93/ElAntimetodo/dispatches', {
          method: 'POST',
          headers: {
            'Accept': 'application/vnd.github.v3+json',
            'Content-Type': 'application/json',
            'Authorization': 'token ' + 'TU_TOKEN_AQUI' // Solo si usas token
          },
          body: JSON.stringify({
            event_type: 'increment_counter'
          })
        });
        
        if (response.ok) {
          localStorage.setItem('hasJoined', 'true');
          document.getElementById('message').textContent = '¡Bienvenido! Actualizando...';
          
          // Esperar y actualizar
          setTimeout(async () => {
            const newData = await fetch('https://luisem93.github.io/ElAntimetodo/data/followers.json?t=' + Date.now());
            const { count } = await newData.json();
            document.getElementById('counter').textContent = count;
          }, 2000);
        }
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('message').textContent = 'Error al conectar. Intenta más tarde.';
      }
    });
    
  } catch (error) {
    console.error('Error cargando contador:', error);
    document.getElementById('counter').textContent = '---';
  }
}

updateCounter();
</script>
